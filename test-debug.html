<!DOCTYPE html>
<html>
<head>
    <title>Swell Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .log { background: #000; padding: 10px; margin: 10px 0; border-left: 3px solid #0f0; }
        .error { border-left-color: #f00; color: #f00; }
        .success { border-left-color: #0f0; color: #0f0; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üêõ Swell Authentication Debug Tool</h1>
    <button onclick="testHash()">Test Hash Extraction</button>
    <button onclick="testLocalStorage()">Test LocalStorage</button>
    <button onclick="testAPI()">Test API Call</button>
    <button onclick="clearAll()">Clear All Data</button>
    <div id="output"></div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz61JIlj9F-84byXh6OjxkM62prukzqJWSKyqhzw8DHliQRijPXmUzlgy14c9CPHfzzAA/exec';

        function log(msg, type = 'log') {
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = new Date().toISOString() + ' - ' + msg;
            document.getElementById('output').appendChild(div);
        }

        function testHash() {
            log('Testing hash extraction...');
            log('Current URL: ' + window.location.href);
            log('Current hash: ' + window.location.hash);
            
            if (window.location.hash && window.location.hash.startsWith('#session=')) {
                const token = window.location.hash.substring('#session='.length);
                log('‚úÖ Token found in hash!', 'success');
                log('Token length: ' + token.length);
                log('Token preview: ' + token.substring(0, 50) + '...');
            } else {
                log('‚ùå No session token in hash', 'error');
            }
        }

        function testLocalStorage() {
            log('Testing localStorage...');
            const token = localStorage.getItem('swell_session');
            if (token) {
                log('‚úÖ Token found in localStorage!', 'success');
                log('Token length: ' + token.length);
                log('Token preview: ' + token.substring(0, 50) + '...');
            } else {
                log('‚ùå No token in localStorage', 'error');
            }
        }

        async function testAPI() {
            const token = localStorage.getItem('swell_session') || 
                         (window.location.hash.startsWith('#session=') ? 
                          window.location.hash.substring('#session='.length) : null);
            
            if (!token) {
                log('‚ùå No token available for API test', 'error');
                return;
            }

            log('Testing API call with token...');
            log('Calling: ' + GOOGLE_SCRIPT_URL);
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'getUserData',
                        token: token
                    })
                });

                log('Response status: ' + response.status);
                log('Response ok: ' + response.ok);
                
                const text = await response.text();
                log('Response text: ' + text);
                
                const data = JSON.parse(text);
                if (data.success && data.user) {
                    log('‚úÖ API call successful!', 'success');
                    log('User email: ' + data.user.email);
                    log('User name: ' + data.user.name);
                } else {
                    log('‚ùå API returned error: ' + (data.error || 'Unknown'), 'error');
                }
            } catch (error) {
                log('‚ùå API call failed: ' + error.message, 'error');
            }
        }

        function clearAll() {
            localStorage.clear();
            window.history.replaceState(null, null, window.location.pathname);
            log('‚úÖ Cleared all data', 'success');
        }

        // Auto-run on load
        window.onload = function() {
            log('Debug tool loaded');
            testHash();
            testLocalStorage();
        };
    </script>
</body>
</html>
