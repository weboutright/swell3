<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="img/favicon.png"/>
    <script>
      // Suppress source map 404 errors in console
      window.addEventListener('error', function(e) {
        if (e.filename && e.filename.includes('.map')) {
          e.preventDefault();
        }
      });
    </script>
    <title>Swell Admin Dashboard - Complete Management Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            overflow-x: hidden;
        }
        
        /* Premium gradient backgrounds */
        .premium-gradient {
            background: linear-gradient(135deg, #065f46 0%, #047857 50%, #059669 100%);
        }
        
        .dashboard-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 50%, #ecfdf5 100%);
        }
        
        /* Sidebar styling */
        .sidebar {
            background: linear-gradient(135deg, rgba(6, 95, 70, 0.95) 0%, rgba(4, 120, 87, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 0;
        }
        
        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }
        
        .sidebar-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #10b981;
        }
        
        /* Enhanced cards with glass morphism */
        .admin-card { 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            box-shadow: 0 25px 50px rgba(4, 120, 87, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Premium buttons with shine effect */
        .btn-premium {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            background-size: 200% 100%;
        }

        /* Typography enhancements */
        .premium-heading {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #064e3b 0%, #047857 50%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .brand-font {
            font-family: 'Luckiest Guy', cursive;
        }
        
        /* Premium input styling */
        .premium-input {
            transition: all 0.3s ease;
            border: 2px solid rgba(16, 185, 129, 0.1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .premium-input:focus {
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
            background: rgba(255, 255, 255, 1);
        }

        /* Status styling */
        .status-success { 
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%); 
            color: #065f46; 
            border: 1px solid rgba(16, 185, 129, 0.2);
            backdrop-filter: blur(10px);
        }
        .status-error { 
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%); 
            color: #991b1b; 
            border: 1px solid rgba(239, 68, 68, 0.2);
            backdrop-filter: blur(10px);
        }

        /* Service card premium styling */
        .service-card {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.9) 0%, rgba(240, 253, 244, 0.7) 100%);
            border: 2px solid rgba(16, 185, 129, 0.2);
            backdrop-filter: blur(10px);
        }

        /* Booking status styling */
        .status-confirmed { 
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%); 
            color: #065f46; 
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .status-pending { 
            background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%); 
            color: #92400e; 
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        .status-cancelled { 
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%); 
            color: #991b1b; 
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Availability styling */
        .availability-available { 
            background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%); 
            border: 2px solid rgba(34, 197, 94, 0.3);
        }
        .availability-blocked { 
            background: linear-gradient(135deg, #fecaca 0%, #fef2f2 100%); 
            border: 2px solid rgba(239, 68, 68, 0.3);
        }
        .availability-holiday { 
            background: linear-gradient(135deg, #ddd6fe 0%, #f5f3ff 100%); 
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        /* Chart container */
        .chart-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
        }
        
        /* Animation for welcome notification */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .animate-slide-in {
            animation: slideInRight 0.5s ease-out;
        }
    </style>
</head>
<body class="dashboard-gradient" onload="lucide.createIcons()">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-64 p-6 fixed left-0 top-0 h-full z-50 shadow-2xl">
            <!-- Logo -->
            <div class="mb-8">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center mr-3">
                        <i data-lucide="waves" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black brand-font text-white">Swell</h1>
                        <p class="text-emerald-200 text-xs">Admin Dashboard</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="space-y-2">
                <a href="javascript:void(0)" class="sidebar-item active flex items-center p-3 text-white" onclick="showSection('system-config', this)">
                    <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">System Configuration</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('analytics', this)">
                    <i data-lucide="trending-up" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Weekly Analytics</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('calendar', this)">
                    <i data-lucide="calendar" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Calendar View</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('bookings', this)">
                    <i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Manage Bookings</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('availability', this)">
                    <i data-lucide="calendar-days" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Business Hours</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('holidays', this)">
                    <i data-lucide="calendar-x" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Holidays & Blocks</span>
                </a>
                <a href="javascript:void(0)" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('deployment', this)">
                    <i data-lucide="code" class="w-5 h-5 mr-3"></i>
                    <span class="font-medium">Deployment & Embed</span>
                </a>
            </nav>

            <!-- User Info -->
            <div class="absolute bottom-6 left-6 right-6">
                <div class="bg-white/10 rounded-xl p-4">
                    <div class="flex items-center">
                        <img id="user-avatar" src="" alt="User" class="w-10 h-10 rounded-full mr-3 border-2 border-white/30" style="display: none;">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3" id="user-avatar-placeholder">
                            <i data-lucide="user" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-white font-semibold text-sm truncate" id="user-name">Loading...</p>
                            <p class="text-emerald-200 text-xs truncate" id="user-email">Administrator</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 ml-64 p-8 overflow-y-auto">
            
            <!-- System Configuration Section -->
            <div id="system-config" class="section-content">
                <!-- Welcome Banner -->
                <div class="admin-card p-8 rounded-3xl text-center mb-8">
                    <div class="flex justify-center mb-6">
                        <div class="w-20 h-20 premium-gradient rounded-2xl flex items-center justify-center shadow-xl">
                            <i data-lucide="crown" class="w-10 h-10 text-white"></i>
                        </div>
                    </div>
                    <h2 class="text-4xl font-black premium-heading mb-4">Welcome to Swell Admin</h2>
                    <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                        Manage your booking automation platform with enterprise-grade controls. Configure services, customize payments, and deploy your booking widget with professional precision.
                    </p>
                </div>

                <!-- System Configuration Panel -->
                <section class="admin-card p-8 rounded-3xl mb-8">
                    <div class="flex items-center mb-8">
                        <div class="w-14 h-14 premium-gradient rounded-xl flex items-center justify-center shadow-lg mr-4">
                            <i data-lucide="settings" class="w-7 h-7 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-black premium-heading">System Configuration</h2>
                            <p class="text-gray-600">Core settings for your booking automation</p>
                        </div>
                    </div>
                    
                    <div class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Calendar ID -->
                            <div class="space-y-2">
                                <label for="calendar-id" class="block text-sm font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="calendar" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                    Google Calendar ID
                                </label>
                                <input type="email" id="calendar-id" class="w-full p-4 premium-input rounded-xl focus:ring-emerald-500 focus:border-emerald-500 font-medium" placeholder="e.g., your-calendar-id@group.calendar.google.com" required>
                                <p class="text-xs text-gray-500 flex items-center mt-2">
                                    <i data-lucide="info" class="w-3 h-3 mr-1"></i>
                                    Primary calendar for availability checks and adding bookings
                                </p>
                            </div>
                            <!-- Admin Email -->
                            <div class="space-y-2">
                                <label for="admin-email" class="block text-sm font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="shield" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                    Your Account
                                </label>
                                <div class="w-full p-4 bg-gray-50 border-2 border-gray-200 rounded-xl font-medium text-gray-700 flex items-center">
                                    <i data-lucide="user-check" class="w-5 h-5 mr-2 text-emerald-600"></i>
                                    <span id="admin-email-display">Loading...</span>
                                </div>
                                <input type="email" id="admin-email" class="hidden" readonly>
                                <p class="text-xs text-gray-500 flex items-center mt-2">
                                    <i data-lucide="info" class="w-3 h-3 mr-1"></i>
                                    Currently logged in as this Google account
                                </p>
                            </div>
                        </div>
                        
                        <!-- Timezone Selection -->
                        <div class="border-t border-emerald-100 pt-8 mt-8">
                            <div class="space-y-4">
                                <label class="block text-sm font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="globe" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                    Your Business Timezone
                                </label>
                                
                                <!-- Detected Timezone Info -->
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded mb-4">
                                    <div class="flex items-start">
                                        <i data-lucide="map-pin" class="w-5 h-5 text-blue-600 mr-2 flex-shrink-0 mt-0.5"></i>
                                        <div class="text-sm">
                                            <p class="font-semibold text-blue-900">Detected timezone: <span id="detected-timezone-display"></span></p>
                                            <p class="text-blue-700 mt-1">All your business hours and bookings will use this timezone.</p>
                                            <button type="button" onclick="useDetectedTimezone()" class="mt-2 text-blue-600 hover:text-blue-800 font-semibold text-xs underline">
                                                Use detected timezone
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Timezone Selector -->
                                <select id="business-timezone" class="w-full p-4 premium-input rounded-xl focus:ring-emerald-500 focus:border-emerald-500 font-medium">
                                    <optgroup label="United States">
                                        <option value="America/New_York">Eastern Time (ET)</option>
                                        <option value="America/Chicago">Central Time (CT)</option>
                                        <option value="America/Denver">Mountain Time (MT)</option>
                                        <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                        <option value="America/Anchorage">Alaska Time (AKT)</option>
                                        <option value="Pacific/Honolulu">Hawaii Time (HT)</option>
                                    </optgroup>
                                    <optgroup label="Canada">
                                        <option value="America/Toronto">Toronto (ET)</option>
                                        <option value="America/Vancouver">Vancouver (PT)</option>
                                        <option value="America/Edmonton">Edmonton (MT)</option>
                                        <option value="America/Winnipeg">Winnipeg (CT)</option>
                                        <option value="America/Halifax">Halifax (AT)</option>
                                    </optgroup>
                                    <optgroup label="Australia">
                                        <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                                        <option value="Australia/Brisbane">Brisbane (AEST)</option>
                                        <option value="Australia/Melbourne">Melbourne (AEST/AEDT)</option>
                                        <option value="Australia/Perth">Perth (AWST)</option>
                                        <option value="Australia/Adelaide">Adelaide (ACST/ACDT)</option>
                                        <option value="Australia/Darwin">Darwin (ACST)</option>
                                    </optgroup>
                                    <optgroup label="United Kingdom & Europe">
                                        <option value="Europe/London">London (GMT/BST)</option>
                                        <option value="Europe/Paris">Paris (CET/CEST)</option>
                                        <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                                        <option value="Europe/Madrid">Madrid (CET/CEST)</option>
                                        <option value="Europe/Rome">Rome (CET/CEST)</option>
                                        <option value="Europe/Amsterdam">Amsterdam (CET/CEST)</option>
                                        <option value="Europe/Brussels">Brussels (CET/CEST)</option>
                                        <option value="Europe/Dublin">Dublin (GMT/IST)</option>
                                    </optgroup>
                                    <optgroup label="Asia">
                                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                                        <option value="Asia/Hong_Kong">Hong Kong (HKT)</option>
                                        <option value="Asia/Singapore">Singapore (SGT)</option>
                                        <option value="Asia/Dubai">Dubai (GST)</option>
                                        <option value="Asia/Kolkata">India (IST)</option>
                                    </optgroup>
                                    <optgroup label="Other">
                                        <option value="Pacific/Auckland">Auckland (NZST/NZDT)</option>
                                        <option value="America/Sao_Paulo">São Paulo (BRT)</option>
                                        <option value="America/Mexico_City">Mexico City (CST)</option>
                                        <option value="Africa/Johannesburg">Johannesburg (SAST)</option>
                                    </optgroup>
                                </select>
                                
                                <p class="text-xs text-gray-500 flex items-center mt-2">
                                    <i data-lucide="info" class="w-3 h-3 mr-1"></i>
                                    Your business hours will be set in this timezone. Customers will see times converted to their local timezone.
                                </p>
                            </div>
                        </div>

                        <!-- Payment Processor Block -->
                        <div class="border-t border-emerald-100 pt-8 mt-8">
                            <!-- Enable/Disable Payments Toggle -->
                            <div class="mb-6 p-6 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl border-2 border-emerald-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center mr-4">
                                            <i data-lucide="dollar-sign" class="w-6 h-6 text-emerald-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-bold text-gray-800">Enable Payment Processing</h3>
                                            <p class="text-sm text-gray-600">Require payment at booking time (disable for free consultations, cash payments, etc.)</p>
                                        </div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="payments-enabled" class="sr-only peer" onchange="togglePaymentSection()">
                                        <div class="w-14 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-6 peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-emerald-600"></div>
                                    </label>
                                </div>
                            </div>

                            <!-- Payment Configuration (Hidden when payments disabled) -->
                            <div id="payment-config-section" style="display: none;">
                                <div class="flex flex-col lg:flex-row gap-8">
                                    <!-- Payment Processor Selection -->
                                    <div class="lg:w-1/3">
                                        <label class="block text-sm font-bold text-gray-800 mb-4 flex items-center">
                                            <i data-lucide="credit-card" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                            Payment Processor
                                        </label>
                                        <div class="space-y-4">
                                            <label class="flex items-center p-4 border-2 border-emerald-200 rounded-xl hover:border-emerald-400 transition-colors cursor-pointer">
                                                <input type="radio" name="payment-type" value="stripe" class="form-radio text-emerald-600 focus:ring-emerald-500 w-5 h-5" checked onchange="updatePaymentPlaceholder(this.value)">
                                                <div class="ml-4">
                                                    <span class="text-gray-800 font-bold text-lg">Stripe</span>
                                                    <p class="text-gray-500 text-sm">Global payment processing</p>
                                                </div>
                                            </label>
                                            <label class="flex items-center p-4 border-2 border-emerald-200 rounded-xl hover:border-emerald-400 transition-colors cursor-pointer">
                                                <input type="radio" name="payment-type" value="square" class="form-radio text-emerald-600 focus:ring-emerald-500 w-5 h-5" onchange="updatePaymentPlaceholder(this.value)">
                                                <div class="ml-4">
                                                    <span class="text-gray-800 font-bold text-lg">Square</span>
                                                    <p class="text-gray-500 text-sm">Point of sale & online payments</p>
                                                </div>
                                            </label>
                                            <input type="hidden" id="payment-processor-type" value="stripe"> 
                                        </div>
                                    </div>

                                    <!-- Payment Link Input -->
                                    <div class="lg:w-2/3">
                                        <label for="base-payment-link" class="block text-sm font-bold text-gray-800 mb-2 flex items-center">
                                            <i data-lucide="link" class="w-4 h-4 mr-2 text-emerald-600"></i>
                                            Checkout Link (<span id="payment-type-label">Stripe</span>)
                                        </label>
                                        <input type="url" id="base-payment-link" class="w-full p-4 premium-input rounded-xl focus:ring-emerald-500 focus:border-emerald-500 font-medium" placeholder="e.g., https://checkout.stripe.com/c/pay/xxxxxxxx">
                                        <p class="text-xs text-gray-500 flex items-center mt-2">
                                            <i data-lucide="info" class="w-3 h-3 mr-1"></i>
                                            The base URL for your selected payment service. Service ID is appended for the final payment link.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Manage Services Panel -->
                <section class="admin-card p-8 rounded-3xl mb-8">
                    <div class="flex items-center mb-8">
                        <div class="w-14 h-14 premium-gradient rounded-xl flex items-center justify-center shadow-lg mr-4">
                            <i data-lucide="briefcase" class="w-7 h-7 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-black premium-heading">Manage Services</h2>
                            <p class="text-gray-600">Configure your booking services and pricing</p>
                        </div>
                    </div>

                    <!-- Service List Container -->
                    <div id="service-list" class="space-y-8">
                        <!-- Service Card Template -->
                        <div class="service-card p-6 rounded-2xl shadow-lg">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-2xl font-bold premium-heading flex items-center">
                                        <i data-lucide="star" class="w-6 h-6 mr-3 text-emerald-600"></i>
                                        Premium Consultation
                                    </h3>
                                    <span class="inline-block px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-semibold mt-2">
                                        ID: svc_consult
                                    </span>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="w-10 h-10 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors flex items-center justify-center">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <!-- Service Name -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-bold text-gray-800 flex items-center">
                                        <i data-lucide="tag" class="w-3 h-3 mr-2 text-emerald-600"></i>
                                        Service Name
                                    </label>
                                    <input type="text" value="Premium Consultation" class="w-full p-3 premium-input rounded-lg font-medium">
                                </div>
                                <!-- Duration -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-bold text-gray-800 flex items-center">
                                        <i data-lucide="clock" class="w-3 h-3 mr-2 text-emerald-600"></i>
                                        Duration (Min)
                                    </label>
                                    <input type="number" class="w-full p-3 premium-input rounded-lg font-medium" placeholder="30" min="15" step="15">
                                </div>
                                <!-- Price -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-bold text-gray-800 flex items-center">
                                        <i data-lucide="dollar-sign" class="w-3 h-3 mr-2 text-emerald-600"></i>
                                        Price (USD)
                                    </label>
                                    <input type="number" class="w-full p-3 premium-input rounded-lg font-medium" placeholder="0.00" step="0.01">
                                </div>
                                <!-- Meeting Link (Optional) -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-bold text-gray-800 flex items-center justify-between">
                                        <span class="flex items-center">
                                            <i data-lucide="video" class="w-3 h-3 mr-2 text-emerald-600"></i>
                                            Meeting Link
                                        </span>
                                        <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">Optional</span>
                                    </label>
                                    <input type="url" class="w-full p-3 premium-input rounded-lg font-medium" placeholder="e.g., https://zoom.us/j/... or leave blank for in-person">
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-emerald-100">
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded-lg mb-4">
                                    <p class="text-xs text-blue-800 flex items-start">
                                        <i data-lucide="info" class="w-3 h-3 mr-2 mt-0.5 flex-shrink-0"></i>
                                        <span><strong>Meeting Link is optional.</strong> Add a Zoom, Google Meet, or Teams link for virtual services. Leave blank for in-person appointments or phone consultations.</span>
                                    </p>
                                </div>
                                <div class="flex justify-end">
                                    <button class="btn-premium px-6 py-3 text-sm font-bold rounded-xl text-white shadow-lg flex items-center">
                                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add Service Button -->
                        <button id="add-service-btn" class="w-full border-3 border-dashed border-emerald-300 text-emerald-700 p-8 rounded-2xl flex items-center justify-center font-bold text-lg">
                            <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mr-4">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </div>
                            Add New Service
                        </button>
                    </div>
                </section>

                <!-- Global Save Button -->
                <div class="text-center py-8">
                    <button id="save-config-btn" class="btn-premium inline-flex items-center justify-center px-16 py-5 font-black text-xl rounded-2xl text-white shadow-2xl">
                        <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-4">
                            <i data-lucide="save" class="w-5 h-5"></i>
                        </div>
                        Save All Configuration Changes
                    </button>
                </div>
            </div>

            <!-- Weekly Analytics Section -->
            <div id="analytics" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Weekly Analytics</h1>
                    <p class="text-gray-600 text-lg">Track your bookings and revenue performance</p>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="admin-card p-6 rounded-2xl text-center">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="calendar-check" class="w-6 h-6 text-green-600"></i>
                        </div>
                        <h3 id="stat-bookings" class="text-2xl font-bold text-gray-900 mb-1">0</h3>
                        <p class="text-gray-600">Bookings This Week</p>
                    </div>
                    <div class="admin-card p-6 rounded-2xl text-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="dollar-sign" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <h3 id="stat-revenue" class="text-2xl font-bold text-gray-900 mb-1">$0</h3>
                        <p class="text-gray-600">Revenue This Week</p>
                    </div>
                    <div class="admin-card p-6 rounded-2xl text-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="trending-up" class="w-6 h-6 text-purple-600"></i>
                        </div>
                        <h3 id="stat-average" class="text-2xl font-bold text-gray-900 mb-1">$0</h3>
                        <p class="text-gray-600">Average Booking Value</p>
                    </div>
                    <div class="admin-card p-6 rounded-2xl text-center">
                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="clock" class="w-6 h-6 text-yellow-600"></i>
                        </div>
                        <h3 id="stat-period" class="text-2xl font-bold text-gray-900 mb-1">7 days</h3>
                        <p class="text-gray-600">Tracking Period</p>
                    </div>
                </div>

                <!-- Charts Section - Coming Soon -->
                <div class="admin-card p-12 rounded-3xl text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-emerald-100 to-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="bar-chart-3" class="w-8 h-8 text-emerald-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Visual Analytics Coming Soon</h3>
                    <p class="text-gray-600 mb-6">We're building beautiful charts and graphs to help you visualize your business performance.</p>
                    <p class="text-sm text-gray-500">Use the summary cards above for real-time booking and revenue data.</p>
                </div>
            </div>

            <!-- Calendar View Section -->
            <div id="calendar" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Calendar View</h1>
                    <p class="text-gray-600 text-lg">Full view of all your bookings and availability</p>
                </div>

                <!-- Calendar Controls -->
                <div class="admin-card p-6 rounded-2xl mb-8">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center space-x-4">
                            <button onclick="previousCalendarMonth()" class="btn-secondary px-4 py-2 text-gray-700 rounded-lg font-semibold">
                                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                            </button>
                            <h2 class="text-2xl font-bold text-gray-800" id="current-calendar-month">January 2025</h2>
                            <button onclick="nextCalendarMonth()" class="btn-secondary px-4 py-2 text-gray-700 rounded-lg font-semibold">
                                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="goToToday()" class="btn-premium px-4 py-2 text-white rounded-lg font-semibold text-sm">
                                <i data-lucide="calendar-days" class="w-4 h-4 mr-2 inline"></i>
                                Today
                            </button>
                            <select id="calendar-view" class="premium-input px-4 py-2 rounded-lg" onchange="changeCalendarView()">
                                <option value="month">Month View</option>
                                <option value="week">Week View</option>
                                <option value="day">Day View</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="admin-card p-4 rounded-xl mb-6">
                    <div class="flex flex-wrap items-center gap-6 text-sm">
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-emerald-500 rounded mr-2"></div>
                            <span class="text-gray-700">Confirmed Booking</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-yellow-500 rounded mr-2"></div>
                            <span class="text-gray-700">Pending Payment</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-purple-500 rounded mr-2"></div>
                            <span class="text-gray-700">Holiday/Blocked</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-emerald-300 rounded mr-2"></div>
                            <span class="text-gray-700">Available</span>
                        </div>
                    </div>
                </div>

                <!-- Month View -->
                <div id="month-view" class="admin-card p-8 rounded-3xl">
                    <!-- Calendar Header -->
                    <div class="grid grid-cols-7 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Sunday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Monday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Tuesday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Wednesday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Thursday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Friday</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-600 mb-2">Saturday</div>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="grid grid-cols-7 gap-4" id="calendar-grid">
                        <!-- Calendar days will be populated here -->
                    </div>
                </div>

                <!-- Week View (Hidden by default) -->
                <div id="week-view" class="admin-card p-8 rounded-3xl hidden">
                    <div class="space-y-2" id="week-grid">
                        <!-- Week view will be populated here -->
                    </div>
                </div>

                <!-- Day View (Hidden by default) -->
                <div id="day-view" class="admin-card p-8 rounded-3xl hidden">
                    <div class="space-y-2" id="day-grid">
                        <!-- Day view will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Bookings Management Section -->
            <div id="bookings" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Manage Bookings</h1>
                    <p class="text-gray-600 text-lg">View and manage all customer bookings</p>
                </div>

                <!-- Booking Filters -->
                <div class="admin-card p-6 rounded-2xl mb-8">
                    <div class="flex flex-wrap gap-4">
                        <select class="premium-input px-4 py-2 rounded-lg">
                            <option>All Statuses</option>
                            <option>Confirmed</option>
                            <option>Pending</option>
                            <option>Cancelled</option>
                        </select>
                        <input type="date" class="premium-input px-4 py-2 rounded-lg">
                        <input type="text" placeholder="Search customer..." class="premium-input px-4 py-2 rounded-lg flex-1">
                        <button class="btn-premium px-4 py-2 text-white rounded-lg font-semibold">
                            <i data-lucide="search" class="w-4 h-4 mr-2 inline"></i>
                            Filter
                        </button>
                    </div>
                </div>

                <!-- Empty State Message -->
                <div class="admin-card p-12 rounded-3xl text-center">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="calendar-x" class="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">No Bookings Yet</h3>
                    <p class="text-gray-500 mb-6">When customers make bookings, they'll appear here for you to manage.</p>
                    <button class="btn-premium px-6 py-3 text-white rounded-xl font-semibold">
                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2 inline"></i>
                        Sync with Calendar
                    </button>
                </div>
            </div>

            <!-- Business Hours Section -->
            <div id="availability" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Business Hours</h1>
                    <p class="text-gray-600 text-lg">Set your regular availability schedule</p>
                </div>

                <div class="admin-card p-8 rounded-3xl">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Weekly Business Hours</h3>
                    
                    <div class="grid grid-cols-1 gap-4">
                        <!-- Days of the week -->
                        <div class="availability-available p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="monday-enabled" checked class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('monday')">
                                    <span class="font-bold text-gray-800 w-20">Monday</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="time" id="monday-start" value="09:00" class="premium-input px-3 py-2 rounded-lg">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="monday-end" value="17:00" class="premium-input px-3 py-2 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <!-- Repeat for other days -->
                        <div class="availability-available p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="tuesday-enabled" checked class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('tuesday')">
                                    <span class="font-bold text-gray-800 w-20">Tuesday</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="time" id="tuesday-start" value="09:00" class="premium-input px-3 py-2 rounded-lg">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="tuesday-end" value="17:00" class="premium-input px-3 py-2 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <div class="availability-available p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="wednesday-enabled" checked class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('wednesday')">
                                    <span class="font-bold text-gray-800 w-20">Wednesday</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="time" id="wednesday-start" value="09:00" class="premium-input px-3 py-2 rounded-lg">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="wednesday-end" value="17:00" class="premium-input px-3 py-2 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <div class="availability-available p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="thursday-enabled" checked class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('thursday')">
                                    <span class="font-bold text-gray-800 w-20">Thursday</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="time" id="thursday-start" value="09:00" class="premium-input px-3 py-2 rounded-lg">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="thursday-end" value="17:00" class="premium-input px-3 py-2 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <div class="availability-available p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="friday-enabled" checked class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('friday')">
                                    <span class="font-bold text-gray-800 w-20">Friday</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="time" id="friday-start" value="09:00" class="premium-input px-3 py-2 rounded-lg">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="friday-end" value="17:00" class="premium-input px-3 py-2 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <div class="availability-blocked p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="saturday-enabled" class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('saturday')">
                                    <span class="font-bold text-gray-800 w-20">Saturday</span>
                                </div>
                                <div class="flex items-center space-x-4 opacity-50">
                                    <input type="time" id="saturday-start" disabled class="premium-input px-3 py-2 rounded-lg" value="09:00">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="saturday-end" disabled class="premium-input px-3 py-2 rounded-lg" value="17:00">
                                </div>
                            </div>
                        </div>

                        <div class="availability-blocked p-4 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input type="checkbox" id="sunday-enabled" class="w-5 h-5 text-emerald-600 rounded" onchange="toggleDayAvailability('sunday')">
                                    <span class="font-bold text-gray-800 w-20">Sunday</span>
                                </div>
                                <div class="flex items-center space-x-4 opacity-50">
                                    <input type="time" id="sunday-start" disabled class="premium-input px-3 py-2 rounded-lg" value="09:00">
                                    <span class="text-gray-600">to</span>
                                    <input type="time" id="sunday-end" disabled class="premium-input px-3 py-2 rounded-lg" value="17:00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end pt-6">
                        <button id="save-hours-btn" class="btn-premium px-8 py-3 text-white rounded-xl font-bold shadow-lg">
                            <i data-lucide="save" class="w-5 h-5 mr-2 inline"></i>
                            Save Business Hours
                        </button>
                    </div>
                </div>
            </div>

            <!-- Holidays Section -->
            <div id="holidays" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Holidays & Special Dates</h1>
                    <p class="text-gray-600 text-lg">Manage temporary blocks and special occasions</p>
                </div>

                <!-- Add Holiday Form -->
                <div class="admin-card p-8 rounded-3xl mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Add Holiday Block</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-800 mb-2">Holiday Name</label>
                            <input type="text" id="holiday-name" class="w-full p-3 premium-input rounded-lg" placeholder="e.g., Christmas Day">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-800 mb-2">Start Date</label>
                            <input type="date" id="holiday-start" class="w-full p-3 premium-input rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-800 mb-2">End Date</label>
                            <input type="date" id="holiday-end" class="w-full p-3 premium-input rounded-lg">
                        </div>
                    </div>
                    <div class="flex justify-end pt-6">
                        <button id="add-holiday-btn" class="btn-premium px-6 py-3 text-white rounded-xl font-semibold">
                            <i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>
                            Add Holiday Block
                        </button>
                    </div>
                </div>

                <!-- Holiday List -->
                <div id="holiday-list" class="space-y-4">
                    <!-- Holiday blocks will appear here -->
                </div>

                <!-- Empty State (shown when no holidays) -->
                <div id="holidays-empty-state" class="admin-card p-12 rounded-3xl text-center">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="calendar-plus" class="w-8 h-8 text-purple-600"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">No Holiday Blocks Set</h3>
                    <p class="text-gray-500 mb-6">Add holiday periods or special date blocks to manage your availability.</p>
                </div>
            </div>

            <!-- Deployment & Embed Options Section -->
            <div id="deployment" class="section-content hidden">
                <div class="mb-8">
                    <h1 class="text-4xl font-black premium-heading mb-2">Deployment & Embed Options</h1>
                    <p class="text-gray-600 text-lg">Get your booking widget code to embed on your website</p>
                </div>

                <!-- Embed Code Options -->
                <div class="space-y-8">
                    <!-- iframe Embed -->
                    <div class="admin-card p-8 rounded-3xl">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center mr-4">
                                <i data-lucide="code" class="w-6 h-6 text-emerald-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">iframe Embed</h3>
                                <p class="text-gray-600">Simple iframe for basic embedding</p>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-6 rounded-xl mb-4 overflow-x-auto">
                            <pre class="text-sm text-gray-200 font-mono" id="iframe-code">&lt;iframe src="LOADING..." width="100%" height="600" frameborder="0"&gt;&lt;/iframe&gt;</pre>
                        </div>
                        <button onclick="copyToClipboard('iframe-code')" class="btn-premium px-4 py-2 text-white rounded-lg font-semibold text-sm">
                            <i data-lucide="copy" class="w-4 h-4 mr-2 inline"></i>
                            Copy Code
                        </button>
                    </div>

                    <!-- JavaScript Widget -->
                    <div class="admin-card p-8 rounded-3xl">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                                <i data-lucide="code-2" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">JavaScript Widget</h3>
                                <p class="text-gray-600">Advanced widget with more customization options</p>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-6 rounded-xl mb-4 overflow-x-auto">
                            <pre class="text-sm text-gray-200 font-mono" id="wp-code">Loading...</pre>
                        </div>
                        <button onclick="copyToClipboard('js-code')" class="btn-premium px-4 py-2 text-white rounded-lg font-semibold text-sm">
                            <i data-lucide="copy" class="w-4 h-4 mr-2 inline"></i>
                            Copy Code
                        </button>
                    </div>

                    <!-- WordPress Plugin -->
                    <div class="admin-card p-8 rounded-3xl">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mr-4">
                                <i data-lucide="plug" class="w-6 h-6 text-purple-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">WordPress Shortcode</h3>
                                <p class="text-gray-600">Easy shortcode for WordPress sites</p>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-6 rounded-xl mb-4 overflow-x-auto">
                            <pre class="text-sm text-gray-200 font-mono" id="wp-code"><span class="text-yellow-300">[swell_booking</span> <span class="text-blue-300">width</span>=<span class="text-green-300">"100%"</span> <span class="text-blue-300">height</span>=<span class="text-green-300">"600px"</span> <span class="text-blue-300">theme</span>=<span class="text-green-300">"modern"</span><span class="text-yellow-300">]</span></pre>
                        </div>
                        <button onclick="copyToClipboard('wp-code')" class="btn-premium px-4 py-2 text-white rounded-lg font-semibold text-sm">
                            <i data-lucide="copy" class="w-4 h-4 mr-2 inline"></i>
                            Copy Code
                        </button>
                    </div>

                    <!-- Direct Link -->
                    <div class="admin-card p-8 rounded-3xl">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mr-4">
                                <i data-lucide="external-link" class="w-6 h-6 text-orange-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Direct Link</h3>
                                <p class="text-gray-600">Standalone booking page link</p>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-6 rounded-xl mb-4 overflow-x-auto">
                            <pre class="text-sm text-blue-300 font-mono" id="link-code">Loading...</pre>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="copyToClipboard('link-code')" class="btn-premium px-4 py-2 text-white rounded-lg font-semibold text-sm">
                                <i data-lucide="copy" class="w-4 h-4 mr-2 inline"></i>
                                Copy Link
                            </button>
                            <button onclick="window.open(document.getElementById('link-code').textContent, '_blank')" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 text-white rounded-lg font-semibold text-sm transition-colors">
                                <i data-lucide="external-link" class="w-4 h-4 mr-2 inline"></i>
                                Open Link
                            </button>
                        </div>
                    </div>

                    <!-- Customization Options -->
                    <div class="admin-card p-8 rounded-3xl">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mr-4">
                                <i data-lucide="palette" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Customization Options</h3>
                                <p class="text-gray-600">Personalize your booking widget appearance</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">Primary Color</label>
                                <input type="color" id="widget-color" value="#065f46" class="w-full h-12 rounded-lg border border-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">Widget Theme</label>
                                <select id="widget-theme" class="w-full p-3 premium-input rounded-lg">
                                    <option value="modern">Modern</option>
                                    <option value="classic">Classic</option>
                                    <option value="minimal">Minimal</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">Widget Width</label>
                                <select id="widget-width" class="w-full p-3 premium-input rounded-lg">
                                    <option value="100%">Full Width (100%)</option>
                                    <option value="800px">Fixed (800px)</option>
                                    <option value="600px">Compact (600px)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">Widget Height</label>
                                <select id="widget-height" class="w-full p-3 premium-input rounded-lg">
                                    <option value="600px">Standard (600px)</option>
                                    <option value="500px">Compact (500px)</option>
                                    <option value="700px">Tall (700px)</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end pt-6">
                            <button onclick="updateEmbedCodes()" class="btn-premium px-6 py-3 text-white rounded-xl font-semibold">
                                <i data-lucide="refresh-cw" class="w-4 h-4 mr-2 inline"></i>
                                Update All Codes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================================================
        // GLOBAL STATE & CONFIG
        // ========================================================================
        window.USER_DATA = {
            user: null,
            config: null,
            token: null,
            exp: null
        };
        
        let GOOGLE_SCRIPT_URL = null;
        let currentViewDate = new Date();
        
        // ========================================================================
        // INITIALIZATION
        // ========================================================================
        
        // Call async function immediately on page load
        (async function initializeAdminPanel() {
            GOOGLE_SCRIPT_URL = await getGoogleScriptUrl();
            console.log('✅ GOOGLE_SCRIPT_URL initialized:', GOOGLE_SCRIPT_URL);
            
            if (GOOGLE_SCRIPT_URL) {
                // Fetch user data FIRST (so USER_DATA is available)
                await fetchUserData();
                
                // Now that we have the URL AND user data, update embed codes (silently on init)
                updateEmbedCodes(true);
                
                // Initialize all sections
                initializeAllSections();
            }
        })();
        
        async function getGoogleScriptUrl() {
            // 1. Try to get from URL query parameter first
            const urlParams = new URLSearchParams(window.location.search);
            const scriptUrlFromQuery = urlParams.get('scriptUrl');
            if (scriptUrlFromQuery) {
                console.log('Found script URL in query parameter.');
                // Save it to localStorage for future visits
                localStorage.setItem('google_script_url', scriptUrlFromQuery);
                // Clean the URL
                window.history.replaceState({}, document.title, window.location.pathname);
                return scriptUrlFromQuery;
            }

            // 2. Fallback to localStorage
            const storedUrl = localStorage.getItem('google_script_url');
            if (storedUrl) {
                return storedUrl;
            }
            
            // 3. If not found anywhere, show setup message
            document.body.innerHTML = `
                <div style="font-family: system-ui; max-width: 600px; margin: 100px auto; padding: 20px; text-align: center;">
                    <h1 style="color: #047857; margin-bottom: 20px;">👋 Welcome to Swell!</h1>
                    <p style="color: #666; font-size: 18px; margin-bottom: 30px;">
                        It looks like you haven't set up your booking system yet.
                    </p>
                    <p style="color: #888;">Redirecting to setup wizard...</p>
                    <p style="margin-top: 30px;">
                        <a href="setup-wizard.html" style="color: #059669; text-decoration: none; font-weight: bold;">
                            Click here if not redirected automatically →
                        </a>
                    </p>
                </div>
            `;
            setTimeout(() => { window.location.href = 'setup-wizard.html'; }, 4000);
            return null;
        }
        
        function initializeAllSections() {
            // Populate settings and user info
            populateConfigFields(window.USER_DATA.config);
            document.getElementById('user-name').textContent = window.USER_DATA.user.name;
            document.getElementById('user-email').textContent = window.USER_DATA.user.email;
            document.getElementById('user-avatar').src = window.USER_DATA.user.avatarUrl;
            
            // Render dynamic content
            renderServices();
            renderHolidays();
            renderCalendar();
            fetchAnalytics();
            fetchBookings();
            
            // Add event listeners
            addEventListeners();
            
            // Show default section
            showSection('system-config', document.querySelector('.sidebar-link'));
        }
        
        // ========================================================================
        // EVENT LISTENERS
        // ========================================================================
        
        function addEventListeners() {
            // Settings
            document.getElementById('settings-form').addEventListener('submit', saveSettings);
            document.getElementById('payment-processor').addEventListener('change', (e) => updatePaymentPlaceholder(e.target.value));
            document.getElementById('payments-enabled').addEventListener('change', togglePaymentSection);
            
            // Business Hours
            document.getElementById('business-hours-form').addEventListener('submit', saveBusinessHours);
            
            // Services
            document.getElementById('add-service-btn').addEventListener('click', () => showServiceModal());
            document.getElementById('service-form').addEventListener('submit', saveService);
            
            // Holidays
            document.getElementById('holiday-form').addEventListener('submit', addHoliday);
            
            // Deployment
            document.getElementById('update-embed-btn').addEventListener('click', () => updateEmbedCodes(false));
            document.getElementById('copy-iframe-btn').addEventListener('click', () => copyToClipboard('iframe-code'));
            document.getElementById('copy-link-btn').addEventListener('click', () => copyToClipboard('link-code'));
            document.getElementById('copy-wp-btn').addEventListener('click', () => copyToClipboard('wp-code'));
            
            // Calendar
            document.getElementById('calendar-prev-month').addEventListener('click', previousCalendarMonth);
            document.getElementById('calendar-next-month').addEventListener('click', nextCalendarMonth);
            document.getElementById('calendar-today').addEventListener('click', goToToday);
            document.getElementById('calendar-view-toggle').addEventListener('change', () => renderCalendar());
        }
        
        // ========================================================================
        // API CALLS
        // ========================================================================
        
        async function apiCall(action, payload = {}) {
            if (!GOOGLE_SCRIPT_URL) {
                showNotification('Google Script URL not configured', 'error');
                return { success: false, error: 'Google Script URL not configured' };
            }
            
            try {
                const body = {
                    token: window.USER_DATA.token,
                    action: action,
                    ...payload
                };
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body),
                    redirect: 'follow'
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    console.error(`API Error (${action}):`, result.error);
                    showNotification(`Error: ${result.error}`, 'error');
                }
                
                return result;
            } catch (error) {
                console.error(`API Call failed (${action}):`, error);
                showNotification('An unexpected error occurred. Check console.', 'error');
                return { success: false, error: error.toString() };
            }
        }
        
        async function fetchUserData() {
            const token = getSessionFromHash();
            if (!token) {
                // Handle missing token - maybe redirect to login
                console.error('Authentication token not found.');
                showNotification('Authentication failed. Please log in again.', 'error');
                // Optionally redirect to login page
                // window.location.href = 'login.html'; 
                return;
            }
            
            const result = await apiCall('getUserData', { token: token });
            
            if (result.success) {
                window.USER_DATA = {
                    user: result.user,
                    config: result.config,
                    token: token,
                    exp: result.exp
                };
                console.log('✅ User data loaded:', result.user.email);
            } else {
                console.error('Failed to load user data:', result.error);
                showNotification('Failed to load user data. Please try again.', 'error');
            }
        }
        
        // ========================================================================
        // UI & NOTIFICATIONS
        // ========================================================================
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = 'notification'; // Reset classes
            
            const typeClass = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            }[type];
            
            notification.classList.add(typeClass, 'show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function showSection(sectionId, element) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show the target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update active link in sidebar
            document.querySelectorAll('.sidebar-item').forEach(link => {
                link.classList.remove('active');
            });
            element.classList.add('active');
        }
        
        // ========================================================================
        // AUTHENTICATION
        // ========================================================================
        
        function getSessionFromHash() {
            const hash = window.location.hash;
            if (hash && hash.startsWith('#session=')) {
                const token = hash.substring('#session='.length);
                // Store token and remove from URL for security
                localStorage.setItem('session_token', token);
                window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
                return token;
            }
            // Fallback to localStorage if no hash
            return localStorage.getItem('session_token');
        }
        
        // ========================================================================
        // DASHBOARD & ANALYTICS
        // ========================================================================
        
        async function fetchAnalytics() {
            const result = await apiCall('getAnalytics');
            if (result.success) {
                const analytics = result.analytics;
                document.getElementById('total-revenue').textContent = `$${analytics.totalRevenue.toFixed(2)}`;
                document.getElementById('total-bookings').textContent = analytics.totalBookings;
                document.getElementById('avg-booking-value').textContent = `$${analytics.averageBookingValue.toFixed(2)}`;
            }
        }
        
        // ========================================================================
        // CALENDAR VIEW
        // ========================================================================
        
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthYearLabel = document.getElementById('calendar-month-year');
            const view = document.getElementById('calendar-view-toggle').value;
            
            calendarGrid.innerHTML = ''; // Clear previous view
            
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth();
            monthYearLabel.textContent = `${currentViewDate.toLocaleString('default', { month: 'long' })} ${year}`;
            
            if (view === 'month') {
                renderMonthView(year, month, calendarGrid);
            } else {
                renderWeekView(currentViewDate, calendarGrid);
            }
        }
        
        function renderMonthView(year, month, grid) {
            grid.className = 'grid grid-cols-7 gap-px bg-gray-200 border border-gray-200';
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Add day headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                grid.innerHTML += `<div class="py-2 text-center text-sm font-semibold text-gray-600 bg-gray-50">${day}</div>`;
            });
            
            // Add blank days
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="bg-white"></div>`;
            }
            
            // Add day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = new Date().getFullYear() === year && new Date().getMonth() === month && new Date().getDate() === day;
                grid.innerHTML += `
                    <div class="relative bg-white p-2 min-h-[120px]">
                        <time datetime="${year}-${month + 1}-${day}" class="${isToday ? 'bg-green-600 text-white rounded-full w-6 h-6 flex items-center justify-center' : ''}">${day}</time>
                        <div class="mt-1 text-xs"></div>
                    </div>
                `;
            }
        }
        
        function renderWeekView(date, grid) {
            grid.className = 'grid grid-cols-1 md:grid-cols-7 gap-px bg-gray-200 border border-gray-200';
            const startOfWeek = new Date(date);
            startOfWeek.setDate(date.getDate() - date.getDay());
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const isToday = new Date().toDateString() === day.toDateString();
                
                grid.innerHTML += `
                    <div class="bg-white p-2 min-h-[200px]">
                        <div class="text-center font-semibold ${isToday ? 'text-green-600' : ''}">
                            ${day.toLocaleString('default', { weekday: 'short' })}
                            <span class="ml-2 ${isToday ? 'bg-green-600 text-white rounded-full w-6 h-6 inline-flex items-center justify-center' : ''}">${day.getDate()}</span>
                        </div>
                        <div class="mt-2 text-xs"></div>
                    </div>
                `;
            }
        }
        
        function previousCalendarMonth() {
            currentViewDate.setMonth(currentViewDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextCalendarMonth() {
            currentViewDate.setMonth(currentViewDate.getMonth() + 1);
            renderCalendar();
        }
        
        function goToToday() {
            currentViewDate = new Date();
            renderCalendar();
        }
        
        // ========================================================================
        // MANAGE BOOKINGS
        // ========================================================================
        
        async function fetchBookings() {
            const result = await apiCall('getBookings');
            if (result.success) {
                renderBookings(result.bookings);
            }
        }
        
        function renderBookings(bookings) {
            const container = document.getElementById('bookings-list');
            if (!bookings || bookings.length === 0) {
                container.innerHTML = '<tr><td colspan="5" class="text-center py-10 text-gray-500">No upcoming bookings.</td></tr>';
                return;
            }
            
            container.innerHTML = bookings.map(booking => `
                <tr class="hover:bg-gray-50">
                    <td class="py-4 px-6">${booking.title}</td>
                    <td class="py-4 px-6">${new Date(booking.start).toLocaleString()}</td>
                    <td class="py-4 px-6">${booking.guests.join(', ')}</td>
                    <td class="py-4 px-6">${booking.location || 'N/A'}</td>
                    <td class="py-4 px-6">
                        <button onclick="cancelBooking('${booking.id}')" class="text-red-600 hover:text-red-800 font-medium">Cancel</button>
                    </td>
                </tr>
            `).join('');
        }
        
        async function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking? This will notify the guest.')) {
                const result = await apiCall('cancelBooking', { bookingId: bookingId });
                if (result.success) {
                    showNotification('Booking cancelled successfully', 'success');
                    fetchBookings(); // Refresh list
                }
            }
        }
        
        // ========================================================================
        // MANAGE SERVICES
        // ========================================================================
        
        function renderServices() {
            const container = document.getElementById('services-list');
            const services = window.USER_DATA.config.services || [];
            
            if (services.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No services configured yet. Add your first service!</p>';
                return;
            }
            
            container.innerHTML = services.map((service, index) => `
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-lg">${service.name}</h4>
                        <p class="text-sm text-gray-600">${service.duration} min - $${service.price}</p>
                        <p class="text-xs text-gray-500">${service.description}</p>
                    </div>
                    <div>
                        <button onclick="showServiceModal(${index})" class="text-blue-600 hover:text-blue-800 mr-4">Edit</button>
                        <button onclick="deleteService(${index})" class="text-red-600 hover:text-red-800">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function showServiceModal(index = null) {
            const modal = document.getElementById('service-modal');
            const form = document.getElementById('service-form');
            form.reset();
            document.getElementById('service-index').value = index;
            
            if (index !== null) {
                const service = window.USER_DATA.config.services[index];
                document.getElementById('service-name').value = service.name;
                document.getElementById('service-description').value = service.description;
                document.getElementById('service-duration').value = service.duration;
                document.getElementById('service-price').value = service.price;
                document.getElementById('service-meeting-link').value = service.meetingLink || '';
            }
            
            modal.classList.remove('hidden');
        }
        
        function hideServiceModal() {
            document.getElementById('service-modal').classList.add('hidden');
        }
        
        async function saveService(event) {
            event.preventDefault();
            const index = document.getElementById('service-index').value;
            const services = [...(window.USER_DATA.config.services || [])];
            
            const newService = {
                id: index ? services[index].id : 'service_' + Date.now(),
                name: document.getElementById('service-name').value,
                description: document.getElementById('service-description').value,
                duration: parseInt(document.getElementById('service-duration').value),
                price: parseFloat(document.getElementById('service-price').value),
                meetingLink: document.getElementById('service-meeting-link').value,
                enabled: true
            };
            
            if (index) {
                services[index] = newService;
            } else {
                services.push(newService);
            }
            
            const result = await apiCall('saveServices', { services: services });
            if (result.success) {
                window.USER_DATA.config.services = services;
                showNotification('Service saved successfully', 'success');
                renderServices();
                hideServiceModal();
            }
        }
        
        async function deleteService(index) {
            if (confirm('Are you sure you want to delete this service?')) {
                const services = [...window.USER_DATA.config.services];
                services.splice(index, 1);
                
                const result = await apiCall('saveServices', { services: services });
                if (result.success) {
                    window.USER_DATA.config.services = services;
                    showNotification('Service deleted', 'success');
                    renderServices();
                }
            }
        }
        
        // ========================================================================
        // BUSINESS HOURS
        // ========================================================================
        
        async function saveBusinessHours(event) {
            event.preventDefault();
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const businessHours = {};
            
            days.forEach(day => {
                businessHours[day] = {
                    enabled: document.getElementById(`hours-${day}-enabled`).checked,
                    start: document.getElementById(`hours-${day}-start`).value,
                    end: document.getElementById(`hours-${day}-end`).value
                };
            });
            
            const result = await apiCall('saveBusinessHours', { businessHours: businessHours });
            if (result.success) {
                window.USER_DATA.config.businessHours = businessHours;
                showNotification('Business hours saved', 'success');
            }
        }
        
        function toggleDayAvailability(day) {
            const isChecked = document.getElementById(`hours-${day}-enabled`).checked;
            document.getElementById(`hours-${day}-start`).disabled = !isChecked;
            document.getElementById(`hours-${day}-end`).disabled = !isChecked;
        }
        
        // ========================================================================
        // HOLIDAYS & BLOCKS
        // ========================================================================
        
        function renderHolidays() {
            const container = document.getElementById('holidays-list');
            const holidays = window.USER_DATA.config.holidays || [];
            
            if (holidays.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No holidays or blocked time added yet.</p>';
                return;
            }
            
            container.innerHTML = holidays.map((holiday, index) => `
                <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex justify-between items-center">
                    <div>
                        <p class="font-semibold">${holiday.name}</p>
                        <p class="text-sm text-gray-600">${holiday.startDate} to ${holiday.endDate}</p>
                    </div>
                    <button onclick="removeHoliday(${index})" class="text-red-600 hover:text-red-800">Remove</button>
                </div>
            `).join('');
        }
        
        async function addHoliday(event) {
            event.preventDefault();
            const holidays = [...(window.USER_DATA.config.holidays || [])];
            
            const newHoliday = {
                name: document.getElementById('holiday-name').value,
                startDate: document.getElementById('holiday-start-date').value,
                endDate: document.getElementById('holiday-end-date').value
            };
            
            holidays.push(newHoliday);
            
            const result = await apiCall('saveHolidays', { holidays: holidays });
            if (result.success) {
                window.USER_DATA.config.holidays = holidays;
                showNotification('Holiday added', 'success');
                renderHolidays();
                event.target.reset();
            }
        }
        
        async function removeHoliday(index) {
            if (confirm('Are you sure you want to remove this holiday/block?')) {
                const holidays = [...window.USER_DATA.config.holidays];
                holidays.splice(index, 1);
                
                const result = await apiCall('saveHolidays', { holidays: holidays });
                if (result.success) {
                    window.USER_DATA.config.holidays = holidays;
                    showNotification('Holiday removed', 'success');
                    renderHolidays();
                }
            }
        }
        
        // ========================================================================
        // SETTINGS
        // ========================================================================
        
        function populateConfigFields(config) {
            if (!config) return;
            
            // General
            document.getElementById('calendar-id').value = config.calendarId || '';
            initializeTimezone();
            document.getElementById('timezone-select').value = config.timezone || '';
            
            // Payments
            document.getElementById('payments-enabled').checked = config.paymentsEnabled || false;
            document.getElementById('payment-processor').value = config.paymentProcessor || 'stripe';
            document.getElementById('base-payment-link').value = config.basePaymentLink || '';
            togglePaymentSection();
            updatePaymentPlaceholder(config.paymentProcessor);
            
            // Business Hours
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                if (config.businessHours && config.businessHours[day]) {
                    document.getElementById(`hours-${day}-enabled`).checked = config.businessHours[day].enabled;
                    document.getElementById(`hours-${day}-start`).value = config.businessHours[day].start;
                    document.getElementById(`hours-${day}-end`).value = config.businessHours[day].end;
                    toggleDayAvailability(day);
                }
            });
        }
        
        async function saveSettings(event) {
            event.preventDefault();
            
            const config = {
                calendarId: document.getElementById('calendar-id').value,
                timezone: document.getElementById('timezone-select').value,
                paymentsEnabled: document.getElementById('payments-enabled').checked,
                paymentProcessor: document.getElementById('payment-processor').value,
                basePaymentLink: document.getElementById('base-payment-link').value
            };
            
            const result = await apiCall('saveConfiguration', { config: config });
            if (result.success) {
                // Update local state
                Object.assign(window.USER_DATA.config, config);
                showNotification('Settings saved successfully!', 'success');
            }
        }
        
        function initializeTimezone() {
            const select = document.getElementById('timezone-select');
            const timezones = Intl.supportedValuesOf('timeZone');
            select.innerHTML = timezones.map(tz => `<option value="${tz}">${tz}</option>`).join('');
            
            // Try to pre-select user's timezone
            try {
                const detected = Intl.DateTimeFormat().resolvedOptions().timeZone;
                if (timezones.includes(detected)) {
                    select.value = detected;
                }
            } catch(e) { console.warn('Could not detect timezone'); }
        }
        
        function updatePaymentPlaceholder(type) {
            const input = document.getElementById('base-payment-link');
            const placeholders = {
                stripe: 'https://buy.stripe.com/...',
                paypal: 'https://paypal.me/your-username',
                custom: 'https://your-payment-provider.com/...'
            };
            input.placeholder = placeholders[type] || placeholders.custom;
        }
        
        function togglePaymentSection() {
            const isEnabled = document.getElementById('payments-enabled').checked;
            document.getElementById('payment-details').style.display = isEnabled ? 'block' : 'none';
        }
        
        // ========================================================================
        // DEPLOYMENT & EMBED
        // ========================================================================
        
        function getWidgetUrl() {
            // Include user email in widget URL so it loads the right user's services
            const userEmail = window.USER_DATA?.user?.email || '';
            
            if (!userEmail) {
                console.warn('⚠️ User email not available yet for widget URL');
                return GOOGLE_SCRIPT_URL + '?page=widget';
            }
            
            const emailParam = '&user=' + encodeURIComponent(userEmail);
            return GOOGLE_SCRIPT_URL + '?page=widget' + emailParam;
        }
        
        function updateEmbedCodes(silent = false) {
            const widgetUrl = getWidgetUrl();
            
            // Check if widget URL has user parameter
            if (!widgetUrl.includes('user=')) {
                console.warn('⚠️ Widget URL missing user parameter, will retry after user data loads');
                return;
            }
            
            const width = document.getElementById('widget-width')?.value || '100%';
            const height = document.getElementById('widget-height')?.value || '600px';
            const color = document.getElementById('widget-color')?.value || '#059669';
            const theme = document.getElementById('widget-theme')?.value || 'modern';
            
            // Build full widget URL with customization parameters
            const separator = widgetUrl.includes('?') ? '&' : '?';
            const customizedUrl = widgetUrl.split('?')[0] + '?' + widgetUrl.split('?')[1].split('&').filter(p => p.startsWith('user=')).join('') + separator +
                'color=' + encodeURIComponent(color) + 
                '&theme=' + encodeURIComponent(theme) +
                '&width=' + encodeURIComponent(width) +
                '&height=' + encodeURIComponent(height);
            
            // Update iframe code
            const iframeCode = `<iframe src="${customizedUrl}" width="${width}" height="${height}" frameborder="0"></iframe>`;
            const iframeElement = document.getElementById('iframe-code');
            if (iframeElement) iframeElement.textContent = iframeCode;
            
            // Update direct link
            const linkElement = document.getElementById('link-code');
            if (linkElement) linkElement.textContent = customizedUrl;
            
            // Update WordPress shortcode
            const wpCode = `[swell_booking url="${customizedUrl}" width="${width}" height="${height}"]`;
            const wpElement = document.getElementById('wp-code');
            if (wpElement) wpElement.textContent = wpCode;
            
            if (!silent) {
                showNotification('Embed codes updated!', 'success');
            } else {
                console.log('✅ Embed codes initialized with user parameter');
            }
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification('Failed to copy', 'error');
            });
        }
        
        </script>
    </body>
</html>
